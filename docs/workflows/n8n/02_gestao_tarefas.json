{
  "name": "BestStag v9.0 - GestÃ£o de Tarefas",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "tarefas",
        "options": {}
      },
      "id": "webhook-tarefas",
      "name": "Webhook Tarefas",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300],
      "webhookId": "beststag-tarefas"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.acao}}",
              "operation": "equal",
              "value2": "criar"
            }
          ]
        }
      },
      "id": "switch-acao",
      "name": "Switch AÃ§Ã£o",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [460, 300],
      "parameters": {
        "options": {
          "allMatchingOutputs": false
        },
        "conditions": {
          "string": [
            {
              "value1": "={{$json.acao}}",
              "operation": "equal",
              "value2": "criar"
            },
            {
              "value1": "={{$json.acao}}",
              "operation": "equal",
              "value2": "listar"
            },
            {
              "value1": "={{$json.acao}}",
              "operation": "equal",
              "value2": "concluir"
            },
            {
              "value1": "={{$json.acao}}",
              "operation": "equal",
              "value2": "atualizar"
            },
            {
              "value1": "={{$json.acao}}",
              "operation": "equal",
              "value2": "deletar"
            }
          ]
        }
      }
    },
    {
      "parameters": {
        "operation": "create",
        "base": "={{$env.AIRTABLE_BASE_ID}}",
        "table": "Tarefas",
        "fields": {
          "usuario": ["{{$json.usuario_id}}"],
          "titulo": "{{$json.titulo}}",
          "descricao": "{{$json.descricao || ''}}",
          "status": "pendente",
          "prioridade": "{{$json.prioridade || 'media'}}",
          "categoria": "{{$json.categoria || 'trabalho'}}",
          "data_vencimento": "{{$json.data_vencimento || ''}}",
          "estimativa_horas": "{{$json.estimativa_horas || 1}}",
          "tags": "{{$json.tags || []}}"
        }
      },
      "id": "criar-tarefa",
      "name": "Criar Tarefa",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 1,
      "position": [680, 200]
    },
    {
      "parameters": {
        "operation": "get",
        "base": "={{$env.AIRTABLE_BASE_ID}}",
        "table": "Tarefas",
        "filterByFormula": "AND(usuario = '{{$json.usuario_id}}', OR(status = 'pendente', status = 'em_andamento'))",
        "sort": [
          {
            "field": "prioridade",
            "direction": "desc"
          },
          {
            "field": "data_vencimento",
            "direction": "asc"
          }
        ]
      },
      "id": "listar-tarefas",
      "name": "Listar Tarefas",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 1,
      "position": [680, 300]
    },
    {
      "parameters": {
        "operation": "update",
        "base": "={{$env.AIRTABLE_BASE_ID}}",
        "table": "Tarefas",
        "id": "={{$json.tarefa_id}}",
        "fields": {
          "status": "concluida",
          "data_conclusao": "={{new Date().toISOString().split('T')[0]}}",
          "progresso": 100
        }
      },
      "id": "concluir-tarefa",
      "name": "Concluir Tarefa",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 1,
      "position": [680, 400]
    },
    {
      "parameters": {
        "operation": "update",
        "base": "={{$env.AIRTABLE_BASE_ID}}",
        "table": "Tarefas",
        "id": "={{$json.tarefa_id}}",
        "fields": "={{$json.campos_atualizacao}}"
      },
      "id": "atualizar-tarefa",
      "name": "Atualizar Tarefa",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 1,
      "position": [680, 500]
    },
    {
      "parameters": {
        "operation": "delete",
        "base": "={{$env.AIRTABLE_BASE_ID}}",
        "table": "Tarefas",
        "id": "={{$json.tarefa_id}}"
      },
      "id": "deletar-tarefa",
      "name": "Deletar Tarefa",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 1,
      "position": [680, 600]
    },
    {
      "parameters": {
        "jsCode": "// Processar resposta da criaÃ§Ã£o de tarefa\nconst tarefa = $input.first().json;\n\nconst resposta = {\n  sucesso: true,\n  mensagem: `âœ… Tarefa criada com sucesso!\\n\\n` +\n            `ðŸ“‹ *${tarefa.fields.titulo}*\\n` +\n            `ðŸŽ¯ Prioridade: ${tarefa.fields.prioridade}\\n` +\n            `ðŸ“‚ Categoria: ${tarefa.fields.categoria}\\n` +\n            `ðŸ“… Vencimento: ${tarefa.fields.data_vencimento || 'NÃ£o definido'}\\n` +\n            `â±ï¸ Estimativa: ${tarefa.fields.estimativa_horas}h\\n\\n` +\n            `ID: ${tarefa.id}`,\n  tarefa_id: tarefa.id,\n  dados: tarefa.fields\n};\n\nreturn [{ json: resposta }];"
      },
      "id": "processar-criacao",
      "name": "Processar CriaÃ§Ã£o",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [900, 200]
    },
    {
      "parameters": {
        "jsCode": "// Processar lista de tarefas\nconst tarefas = $input.first().json.records || [];\n\nif (tarefas.length === 0) {\n  return [{\n    json: {\n      sucesso: true,\n      mensagem: `ðŸ“‹ *Suas Tarefas*\\n\\n` +\n                `ðŸŽ‰ ParabÃ©ns! VocÃª nÃ£o tem tarefas pendentes.\\n\\n` +\n                `Use */tarefa criar [descriÃ§Ã£o]* para adicionar uma nova tarefa.`,\n      total: 0\n    }\n  }];\n}\n\nlet mensagem = `ðŸ“‹ *Suas Tarefas Pendentes* (${tarefas.length})\\n\\n`;\n\ntarefas.forEach((tarefa, index) => {\n  const prioridadeIcon = {\n    'urgente': 'ðŸ”´',\n    'alta': 'ðŸŸ ', \n    'media': 'ðŸŸ¡',\n    'baixa': 'ðŸŸ¢'\n  }[tarefa.fields.prioridade] || 'âšª';\n  \n  const statusIcon = {\n    'pendente': 'â³',\n    'em_andamento': 'ðŸ”„',\n    'concluida': 'âœ…'\n  }[tarefa.fields.status] || 'â“';\n  \n  const vencimento = tarefa.fields.data_vencimento ? \n    ` (ðŸ“… ${new Date(tarefa.fields.data_vencimento).toLocaleDateString('pt-BR')})` : '';\n  \n  mensagem += `${index + 1}. ${prioridadeIcon} ${statusIcon} ${tarefa.fields.titulo}${vencimento}\\n`;\n  \n  if (tarefa.fields.progresso > 0) {\n    mensagem += `   ðŸ“Š Progresso: ${tarefa.fields.progresso}%\\n`;\n  }\n  \n  mensagem += `\\n`;\n});\n\nmensagem += `ðŸ’¡ Use */tarefa concluir [nÃºmero]* para marcar como concluÃ­da.\\n`;\nmensagem += `âš™ï¸ Use */tarefa atualizar [nÃºmero]* para editar.`;\n\nreturn [{\n  json: {\n    sucesso: true,\n    mensagem: mensagem,\n    total: tarefas.length,\n    tarefas: tarefas\n  }\n}];"
      },
      "id": "processar-listagem",
      "name": "Processar Listagem",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [900, 300]
    },
    {
      "parameters": {
        "jsCode": "// Processar conclusÃ£o de tarefa\nconst tarefa = $input.first().json;\n\nconst resposta = {\n  sucesso: true,\n  mensagem: `âœ… *Tarefa ConcluÃ­da!*\\n\\n` +\n            `ðŸ“‹ ${tarefa.fields.titulo}\\n` +\n            `ðŸ“… ConcluÃ­da em: ${new Date().toLocaleDateString('pt-BR')}\\n\\n` +\n            `ðŸŽ‰ ParabÃ©ns! Continue assim!`,\n  tarefa_id: tarefa.id\n};\n\nreturn [{ json: resposta }];"
      },
      "id": "processar-conclusao",
      "name": "Processar ConclusÃ£o",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [900, 400]
    },
    {
      "parameters": {
        "jsCode": "// Processar atualizaÃ§Ã£o de tarefa\nconst tarefa = $input.first().json;\n\nconst resposta = {\n  sucesso: true,\n  mensagem: `ðŸ”„ *Tarefa Atualizada!*\\n\\n` +\n            `ðŸ“‹ ${tarefa.fields.titulo}\\n` +\n            `ðŸŽ¯ Status: ${tarefa.fields.status}\\n` +\n            `ðŸ“Š Progresso: ${tarefa.fields.progresso || 0}%\\n\\n` +\n            `âœ¨ AlteraÃ§Ãµes salvas com sucesso!`,\n  tarefa_id: tarefa.id\n};\n\nreturn [{ json: resposta }];"
      },
      "id": "processar-atualizacao",
      "name": "Processar AtualizaÃ§Ã£o",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [900, 500]
    },
    {
      "parameters": {
        "jsCode": "// Processar exclusÃ£o de tarefa\nconst resposta = {\n  sucesso: true,\n  mensagem: `ðŸ—‘ï¸ *Tarefa ExcluÃ­da*\\n\\n` +\n            `A tarefa foi removida permanentemente.\\n\\n` +\n            `âš ï¸ Esta aÃ§Ã£o nÃ£o pode ser desfeita.`,\n  tarefa_id: $input.first().json.tarefa_id\n};\n\nreturn [{ json: resposta }];"
      },
      "id": "processar-exclusao",
      "name": "Processar ExclusÃ£o",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [900, 600]
    },
    {
      "parameters": {
        "operation": "create",
        "base": "={{$env.AIRTABLE_BASE_ID}}",
        "table": "Interacoes",
        "fields": {
          "usuario": ["{{$json.usuario_id}}"],
          "tipo": "api",
          "canal": "tarefa_api",
          "comando": "tarefa_{{$json.acao}}",
          "contexto": "{{JSON.stringify($json)}}",
          "status": "{{$json.sucesso ? 'sucesso' : 'erro'}}",
          "modelo_ia_usado": "sistema",
          "memoria_camada": "MCP"
        }
      },
      "id": "registrar-interacao",
      "name": "Registrar InteraÃ§Ã£o",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 1,
      "position": [1120, 400]
    },
    {
      "parameters": {
        "jsCode": "// AnÃ¡lise inteligente de tarefas para sugestÃµes\nconst acao = $input.first().json.acao;\nconst dados = $input.first().json;\n\nlet sugestoes = [];\n\n// SugestÃµes baseadas na aÃ§Ã£o\nswitch(acao) {\n  case 'criar':\n    // Analisar tÃ­tulo para sugerir categoria e prioridade\n    const titulo = dados.titulo.toLowerCase();\n    \n    if (titulo.includes('urgente') || titulo.includes('asap') || titulo.includes('hoje')) {\n      sugestoes.push('Detectei urgÃªncia - prioridade definida como ALTA');\n    }\n    \n    if (titulo.includes('cliente') || titulo.includes('proposta') || titulo.includes('reuniÃ£o')) {\n      sugestoes.push('Categoria sugerida: TRABALHO');\n    }\n    \n    if (titulo.includes('casa') || titulo.includes('pessoal') || titulo.includes('famÃ­lia')) {\n      sugestoes.push('Categoria sugerida: PESSOAL');\n    }\n    \n    // Sugerir estimativa baseada em palavras-chave\n    if (titulo.includes('revisar') || titulo.includes('ler')) {\n      sugestoes.push('Estimativa sugerida: 1-2 horas');\n    } else if (titulo.includes('criar') || titulo.includes('desenvolver')) {\n      sugestoes.push('Estimativa sugerida: 3-4 horas');\n    }\n    \n    break;\n    \n  case 'listar':\n    // Analisar padrÃµes nas tarefas listadas\n    const tarefas = dados.tarefas || [];\n    const totalPendentes = tarefas.length;\n    \n    if (totalPendentes > 10) {\n      sugestoes.push('ðŸ’¡ VocÃª tem muitas tarefas pendentes. Considere priorizar as mais importantes.');\n    }\n    \n    const tarefasVencidas = tarefas.filter(t => \n      t.fields.data_vencimento && new Date(t.fields.data_vencimento) < new Date()\n    ).length;\n    \n    if (tarefasVencidas > 0) {\n      sugestoes.push(`âš ï¸ VocÃª tem ${tarefasVencidas} tarefa(s) vencida(s). Priorize-as!`);\n    }\n    \n    break;\n}\n\n// Adicionar sugestÃµes de produtividade\nconst horaAtual = new Date().getHours();\nif (horaAtual >= 9 && horaAtual <= 11) {\n  sugestoes.push('ðŸŒ… ManhÃ£ Ã© ideal para tarefas que exigem mais concentraÃ§Ã£o!');\n} else if (horaAtual >= 14 && horaAtual <= 16) {\n  sugestoes.push('â˜€ï¸ Tarde Ã© boa para reuniÃµes e tarefas colaborativas!');\n}\n\nreturn [{\n  json: {\n    ...dados,\n    sugestoes: sugestoes,\n    timestamp: new Date().toISOString()\n  }\n}];"
      },
      "id": "analise-inteligente",
      "name": "AnÃ¡lise Inteligente",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [1340, 300]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.sucesso}}",
              "value2": true
            }
          ]
        }
      },
      "id": "verificar-sucesso",
      "name": "Verificar Sucesso",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1560, 300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{JSON.stringify($json)}}"
      },
      "id": "resposta-sucesso",
      "name": "Resposta Sucesso",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1780, 200]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{JSON.stringify({sucesso: false, erro: $json.erro || 'Erro interno', codigo: 500})}}"
      },
      "id": "resposta-erro",
      "name": "Resposta Erro",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1780, 400]
    }
  ],
  "connections": {
    "Webhook Tarefas": {
      "main": [
        [
          {
            "node": "Switch AÃ§Ã£o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch AÃ§Ã£o": {
      "main": [
        [
          {
            "node": "Criar Tarefa",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Listar Tarefas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Concluir Tarefa",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Atualizar Tarefa",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Deletar Tarefa",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Criar Tarefa": {
      "main": [
        [
          {
            "node": "Processar CriaÃ§Ã£o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Listar Tarefas": {
      "main": [
        [
          {
            "node": "Processar Listagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Concluir Tarefa": {
      "main": [
        [
          {
            "node": "Processar ConclusÃ£o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atualizar Tarefa": {
      "main": [
        [
          {
            "node": "Processar AtualizaÃ§Ã£o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Deletar Tarefa": {
      "main": [
        [
          {
            "node": "Processar ExclusÃ£o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Processar CriaÃ§Ã£o": {
      "main": [
        [
          {
            "node": "AnÃ¡lise Inteligente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Processar Listagem": {
      "main": [
        [
          {
            "node": "AnÃ¡lise Inteligente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Processar ConclusÃ£o": {
      "main": [
        [
          {
            "node": "AnÃ¡lise Inteligente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Processar AtualizaÃ§Ã£o": {
      "main": [
        [
          {
            "node": "AnÃ¡lise Inteligente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Processar ExclusÃ£o": {
      "main": [
        [
          {
            "node": "AnÃ¡lise Inteligente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AnÃ¡lise Inteligente": {
      "main": [
        [
          {
            "node": "Registrar InteraÃ§Ã£o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Registrar InteraÃ§Ã£o": {
      "main": [
        [
          {
            "node": "Verificar Sucesso",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verificar Sucesso": {
      "main": [
        [
          {
            "node": "Resposta Sucesso",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Resposta Erro",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": ["beststag", "tarefas", "v9.0", "crud"],
  "triggerCount": 1,
  "updatedAt": "2025-06-03T20:00:00.000Z",
  "versionId": "v9.0"
}

